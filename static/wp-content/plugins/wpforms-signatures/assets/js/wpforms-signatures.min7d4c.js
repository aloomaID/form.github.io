"use strict";var WPFormsSignatures=window.WPFormsSignatures||function(u,t,i){var r={config:{windowWidth:!1,pixelRatio:Math.max(t.devicePixelRatio||1,1),watching:!1,watchingRate:300},getCanvas:function(t){t=t.get(0);return t.width=t.offsetWidth*r.config.pixelRatio,t.height=t.offsetHeight*r.config.pixelRatio,t.getContext("2d").scale(r.config.pixelRatio,r.config.pixelRatio),t},cropCanvas:function(t){for(var n,i=u.createElement("canvas"),a=i.getContext("2d"),e=(i.width=t.width,i.height=t.height,a.drawImage(t,0,0),i.width),r=i.height,s={x:[],y:[]},o=a.getImageData(0,0,i.width,i.height),g=0;g<r;g++)for(n=0;n<e;n++)0<o.data[3+4*(g*e+n)]&&(s.x.push(n),s.y.push(g));return s.x.sort(function(t,n){return t-n}),s.y.sort(function(t,n){return t-n}),t=s.x.length-1,e=s.x[t]-s.x[0],r=s.y[t]-s.y[0],t=a.getImageData(s.x[0],s.y[0],e,r),i.width=e,i.height=r,a.putImageData(t,0,0),i.toDataURL()},watchSignatures:function(){var n=!0;i(".wpforms-signature-canvas").each(function(){var t=i(this);t.hasClass("loaded")||(n=!1,t.is(":hidden"))||a.loadSignature(t)}),n&&(clearInterval(r.config.watching),r.config.watching=!1)}},a={init:function(){i(u).on("wpformsReady",a.ready)},ready:function(){r.config.windowWidth=i(t).width(),a.loadSignatures(),a.events(),r.config.watching=setInterval(r.watchSignatures,r.config.watchingRate)},events:function(){i(u).on("click",".wpforms-signature-clear",function(t){t.preventDefault(),a.resetSignature(i(this).parent().find(".wpforms-signature-canvas"),!0)}),i(u).on("mousedown",".wpforms-signature-wrap",function(){i(this).addClass("wpforms-focus").closest(".wpforms-field-signature").find(".wpforms-signature-input").trigger("focus")}),i(u).on("mouseup",".wpforms-signature-wrap",function(){i(this).removeClass("wpforms-focus").closest(".wpforms-field-signature").find(".wpforms-signature-input").trigger("focus")}),i(t).resize(a.resetSignatures)},loadSignatures:function(){i(".wpforms-signature-canvas").each(function(){a.loadSignature(i(this))})},loadSignature:function(t){var n=t.closest(".wpforms-field-signature").find(".wpforms-signature-input"),i=r.getCanvas(t),a=t.data("color");t.is(":hidden")||(t.addClass("loaded"),a=new SignaturePad(i,{penColor:a,onEnd:function(){n.val(r.cropCanvas(i)).trigger("input change").valid()}}),t.data("signaturePad",a))},resetSignatures:function(){r.config.windowWidth!==i(t).width()&&i(".wpforms-signature-canvas").each(function(){a.resetSignature(i(this),!1)})},resetSignature:function(t,n){var i=t.closest(".wpforms-field-signature").find(".wpforms-signature-input"),a=t.data("signaturePad"),e=a.toDataURL("image/svg+xml");n?(a.clear(),i.val("")):(r.getCanvas(t),a.fromDataURL(e)),i.trigger("input change"),t.is(":hidden")&&(t.removeClass("loaded"),r.config.watching||(r.config.watching=setInterval(r.watchSignatures,r.config.watchingRate)))}};return a}(document,window,jQuery);WPFormsSignatures.init();